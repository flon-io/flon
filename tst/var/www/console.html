
<!DOCTYPE HTML>

<html>
  <head>
    <title>flon</title>
    <link href="css/flon.css" rel="stylesheet" />
  </head>

  <body>

    <div id="header">
        <div class="logo">
          <a href="http://flon.io?console=1" target="_blank">
            <img src="images/flon_io.png" />
            <span>flon</span>
          </a>
        </div>
    </div>

    <div class="panes">

      <div class="left-pane">

        <div class="tabs">
          <div id="postFormTab" class="tab selected">post</div>
          <div id="inspectorTab" class="tab">inspect</div>
        </div>

        <div id="postForm" class="sub-pane">
          <h2>post to /i/in</h2>
          <p>
            <textarea id="inField">
            </textarea>
            <input id="inSubmit" type="submit" />
          </p>
        </div>

        <div id="inspector" class="sub-pane">
          <h2>inspect something</h2>
          nothing
        </div>
      </div>

      <div class="right-pane">

        <div id="log">
          <div><!-- placeholder --></div>
        </div>
      </div>
    </div>

    <script src="js/handlebars.js"></script>
    <script src="js/flon.js"></script>

    <script>

      var RELS = "http://flon.io/rels.html";

      function inOnError(e)
      {
        console.log(e);
      }
      function inOnLoad(e)
      {
        var msg = JSON.parse(e.target.responseText);

        msg.href = msg._links[RELS + '#execution'];

        console.log(msg);
        var html = postAnswerTemplate(msg);
        var log = byid('log');
        log.children[0].insertAdjacentHTML('beforebegin', html);
      }

      function inSubmit()
      {
        var req = new XMLHttpRequest();
        req.open('POST', './i/in', true);
        req.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        req.onerror = inOnError;
        req.onload = inOnLoad;
        req.send(document.getElementById("inField").value);
      }

      function onTabClick(e)
      {
        byclass("tab").forEach(function(e) { e.classList.remove('selected'); });
        e.target.classList.add('selected');

        byclass("sub-pane").forEach(function(e) { e.style.display = 'none' });
        byid(e.target.id.slice(0, -3)).style.display = 'block';
      }

      var postAnswerTemplate = null;

      document.addEventListener('DOMContentLoaded', function() {

        byid("inSubmit").addEventListener('click', inSubmit);

        byclass("tab").forEach(function(e) {
          e.addEventListener('click', onTabClick);
        });

        byid("inField").textContent = byid("launchJson").textContent;
        byid("postForm").style.display = 'block';

        postAnswerTemplate =
          Handlebars.compile(byid("postAnswerTemplate").innerHTML);
      });
    </script>

    <div id="launchJson" class="hidden">
{
  domain: org.example
  execute:
    [ sequence, {}, [
      [ invoke, { _0: stamp, color: red }, [] ]
      [ invoke, { _0: stamp, color: green }, [] ]
      [ invoke, { _0: stamp, color: blue }, [] ]
    ] ]
  payload: {
    hello: world
  }
}
    </div>

    <div id="postAnswerTemplate" class="hidden">
      <div>
        {{ tstamp }} -
        {{ message }} -
        <a href="#" xhref="{{ href }}">{{ exid }}</a></div>
    </div>
  </body>
</html>

